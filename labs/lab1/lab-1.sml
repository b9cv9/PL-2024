(****************************************************************************** 
  Шаблон для выполнения заданий лабораторной работы №1

  НЕ СЛЕДУЕТ УДАЛЯТЬ ИЛИ ПЕРЕСТАВЛЯТЬ МЕСТАМИ ЭЛЕМЕНТЫ, 
  ПРЕДСТАВЛЕННЫЕ В ШАБЛОНЕ (ВКЛЮЧАЯ КОММЕНТАРИИ). 
  ЭЛЕМЕНТЫ РЕШЕНИЯ СЛЕДУЕТ ВПИСЫВАТЬ В ПРОМЕЖУТКИ,
  ОПРЕДЕЛЕННЫЕ КОММЕНТАРИЯМИ.
 ******************************************************************************)

(****************************************************************************** 
  Загрузка определений модулей MyDate и Fixed и вспомогательных списков данных 
 ******************************************************************************)
use "lab-1-use.sml";

(****************************************************************************** 
  Задание 1 isLeapYear
 ******************************************************************************)
fun isLeapYear (year : int, isJulian : bool) : bool =
  if isJulian then year mod 4 = 0
  else year mod 400 = 0
  orelse year mod 100 <> 0 andalso year mod 4 = 0

(******************************************************************************)

(****************************************************************************** 
  Задание 2 isLongMonth
 ******************************************************************************)
fun isLongMonth (month : int) : bool =
  if month < 8 then (month + 1) mod 2 = 0
  else month mod 2 = 0

(******************************************************************************)

(****************************************************************************** 
  Задание 3 daysInMonth
 ******************************************************************************)
fun daysInMonth (d : date, isJulian : bool) : int =
  if (#2 d = 2 andalso isLeapYear (#3 d, isJulian)) 
  then 29
  else if #2 d = 2 
       then 28
       else if isLongMonth (#2 d)
            then 31
            else 30

(******************************************************************************)

(****************************************************************************** 
  Задание 4 isDayOK
 ******************************************************************************)
fun isDayOK (d : date, isJulian : bool) : bool =
  not (#1 d < 1 orelse #1 d > daysInMonth (d, isJulian))

(******************************************************************************)

(****************************************************************************** 
  Задание 5 isMonthOK
 ******************************************************************************)
fun isMonthOK (d : date) : bool =
  not (#2 d < 1 orelse #2 d > 12)

(******************************************************************************)

(****************************************************************************** 
  Задание 6 isCorrectDate
 ******************************************************************************)
fun isCorrectDate (d : date, isJulian : bool) : bool =
  isDayOK (d, isJulian) andalso isMonthOK d
(******************************************************************************)

(****************************************************************************** 
  Задание 7 incDateByNum
 ******************************************************************************)
fun incDateByNum (d : date, days : int, isJulian : bool) : date =
  let
    val day = #1 d
    val dayPlusDays = day + days
  in
    if dayPlusDays <= daysInMonth (d, isJulian)
    then MyDate.anotherDay (d, dayPlusDays) 
    else 
      let
        val month = #2 d
        val year = #3 d
        val newDays = days - daysInMonth (d, isJulian) + day - 1
      in
        if month < 12 then
          incDateByNum( (1, month + 1, year), newDays, isJulian)
        else incDateByNum( (1, 1, year + 1), newDays, isJulian)
      end
  end


(******************************************************************************)

(****************************************************************************** 
  Задание 8 decDateByNum
 ******************************************************************************)
fun decDateByNum (d : date, daysMinus : int, isJulian : bool) : date =
  let
    val day = #1 d
    val daysDiff = day - daysMinus
  in
    if daysDiff > 0 then 
      MyDate.anotherDay (d, daysDiff) 
    else
      let
        val year = #3 d
        val daysMinusDay = daysMinus - day
        val monthMinus1 = #2 d - 1
      in
        if monthMinus1 + 1 > 1 then 
          decDateByNum ( (daysInMonth ((day, monthMinus1, year), isJulian)
                         , monthMinus1, year
                         )
                       , daysMinusDay, isJulian
                       )
        else decDateByNum ( (31, 12, year - 1), daysMinusDay, isJulian)
      end
  end

(******************************************************************************)

(****************************************************************************** 
  Задание 9 newStyleCorrection
 ******************************************************************************)
fun newStyleCorrection (date : date) : int =
  let
    val year = #3 date
    val month = #2 date
    val century = year div 100
    val daysDiff = century - century div 4 - 2
  in
      if year mod 100 > 0 orelse month > 2 orelse month = 2
                          andalso #1 date = 29
    then daysDiff
    else daysDiff - 1
  end

(******************************************************************************)

(****************************************************************************** 
  Задание 10 toJulianDay
 ******************************************************************************)
fun toJulianDay (grigDate : date) : date =
  decDateByNum (grigDate, newStyleCorrection (grigDate), false)

(******************************************************************************)

(****************************************************************************** 
  Задание 11 toGrigorianDay
 ******************************************************************************)
fun toGrigorianDay (julianDate : date) : date =
  incDateByNum (julianDate, newStyleCorrection (julianDate), true)

(******************************************************************************)

(****************************************************************************** 
  Задание 12 younger
 ******************************************************************************)
fun younger (date1 : date, date2 : date) : bool =
  let
    val y1 = #3 date1
    val y2 = #3 date2
    val m1 = #2 date1
    val m2 = #2 date2
  in
    if y1 <> y2      then y1 > y2
    else if m1 <> m2 then m1 > m2
    else #1 date1 > #1 date2
  end

(******************************************************************************)

(****************************************************************************** 
  Задание 13 youngest
 ******************************************************************************)
(*fun youngest (l : (string * date) list) : (string * date) option =
  if null l then NONE
  else
    let
      val head = #2 (hd l)
      val newHead = #2 (hd (tl l))
    in
      if younger (head, newHead) then result
    end*)

(******************************************************************************)

(****************************************************************************** 
  Задание 14 getNthFixed
 ******************************************************************************)
fun getNthFixed (values : int * fixed list) : fixed =
  let val n = #1 values
      val l = #2 values
  in
    if n = 0 then hd (l) else getNthFixed (n - 1, tl l)
  end
(******************************************************************************)

(****************************************************************************** 
  Задание 15 numToDigits
 ******************************************************************************)
fun numToDigits (ntg : int * int) : int list =
  if #2 ntg = null then []
  else (#1 ntg mod 10) :: numToDigits (#1 ntg div 10, #2 ntg - 1)

(******************************************************************************)

(****************************************************************************** 
  Задание 16 listElements
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 17 listSum
 ******************************************************************************)
fun listSum (fl : fixed list) : fixed =
  if null fl then 0
  else hd fl + listSum (tl fl)

(******************************************************************************)

(****************************************************************************** 
  Задание 18 maxSmaller
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 19 dateToCorrectionNums
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 20 firstNewMoon
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 21 winterSolstice
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 22 chineseNewYearDate
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 23 getNthString
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 24 dateToString
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 25 chineseYear
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 26 dateToChineseYear
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 27 dateToAnimal
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 28 animal
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 29 extractAnimal
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 30 extractAnimals
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 31 youngestFromAnimals
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 32 oldStyleStudents
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 33 youngestFromOldStyleAnimals
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 34 listOfStringDates
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 35 oldStyleStudentStringDates
 ******************************************************************************)


(******************************************************************************)

