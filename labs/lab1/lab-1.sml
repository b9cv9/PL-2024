(****************************************************************************** 
  Шаблон для выполнения заданий лабораторной работы №1

  НЕ СЛЕДУЕТ УДАЛЯТЬ ИЛИ ПЕРЕСТАВЛЯТЬ МЕСТАМИ ЭЛЕМЕНТЫ, 
  ПРЕДСТАВЛЕННЫЕ В ШАБЛОНЕ (ВКЛЮЧАЯ КОММЕНТАРИИ). 
  ЭЛЕМЕНТЫ РЕШЕНИЯ СЛЕДУЕТ ВПИСЫВАТЬ В ПРОМЕЖУТКИ,
  ОПРЕДЕЛЕННЫЕ КОММЕНТАРИЯМИ.
 ******************************************************************************)

(****************************************************************************** 
  Загрузка определений модулей MyDate и Fixed и вспомогательных списков данных 
 ******************************************************************************)
use "lab-1-use.sml";

(****************************************************************************** 
  Задание 1 isLeapYear
 ******************************************************************************)
fun isLeapYear (year : int, isJulian : bool) : bool =
  if isJulian then year mod 4 = 0
  else year mod 400 = 0
  orelse year mod 100 <> 0 andalso year mod 4 = 0

(******************************************************************************)

(****************************************************************************** 
  Задание 2 isLongMonth
 ******************************************************************************)
fun isLongMonth (month : int) : bool =
  if month < 8 then (month + 1) mod 2 = 0
  else month mod 2 = 0

(******************************************************************************)

(****************************************************************************** 
  Задание 3 daysInMonth
 ******************************************************************************)
fun daysInMonth (d : date, isJulian : bool) : int =
  if (#2 d = 2 andalso isLeapYear (#3 d, isJulian)) 
  then 29
  else if #2 d = 2 
  then 28
  else if isLongMonth (#2 d)
  then 31
  else 30

(******************************************************************************)

(****************************************************************************** 
  Задание 4 isDayOK
 ******************************************************************************)
fun isDayOK (d : date, isJulian : bool) : bool =
  not (#1 d < 1 orelse #1 d > daysInMonth (d, isJulian))

(******************************************************************************)

(****************************************************************************** 
  Задание 5 isMonthOK
 ******************************************************************************)
fun isMonthOK (d : date) : bool =
  not (#2 d < 1 orelse #2 d > 12)

(******************************************************************************)

(****************************************************************************** 
  Задание 6 isCorrectDate
 ******************************************************************************)
fun isCorrectDate (d : date, isJulian : bool) : bool =
  isDayOK (d, isJulian) andalso isMonthOK d
(******************************************************************************)

(****************************************************************************** 
  Задание 7 incDateByNum
 ******************************************************************************)
fun incDateByNum (d : date, days : int, isJulian : bool) : date =
  let
    val day = #1 d
    val dayPlusDays = day + days
  in
    if dayPlusDays <= daysInMonth (d, isJulian)
    then MyDate.anotherDay (d, dayPlusDays) 
    else 
      let
        val dayMinus1 = day - 1
        val month = #2 d
        val year = #3 d
      in
        if month < 12 then 
          incDateByNum( (1, month + 1, year)
                      , days - daysInMonth (d, isJulian) + dayMinus1
                      , isJulian
                      )
        else 
          incDateByNum( (1, 1, year + 1)
                      , days - daysInMonth (d, isJulian) + dayMinus1
                      , isJulian
                      )
      end
  end


(******************************************************************************)

(****************************************************************************** 
  Задание 8 decDateByNum
 ******************************************************************************)
fun decDateByNum (d : date, daysMinus : int, isJulian : bool) : date =
  let
    val day = #1 d
    val daysDiff = day - daysMinus
  in
    if daysDiff > 0 then 
      MyDate.anotherDay (d, daysDiff) 
    else
      let
        val year = #3 d
        val daysMinusDay = daysMinus - day
        val monthMinus1 = #2 d - 1
      in
        if monthMinus1 + 1 > 1 then 
          decDateByNum ( (daysInMonth ((day, monthMinus1, year), isJulian)
                         , monthMinus1, year
                         )
                       , daysMinusDay, isJulian
                       )
        else 
          decDateByNum ( (31, 12, year - 1), daysMinusDay, isJulian)
      end
  end

(******************************************************************************)

(****************************************************************************** 
  Задание 9 newStyleCorrection
 ******************************************************************************)
fun newStyleCorrection (date : date) : int =
  let
    val year = #3 date
    val month = #2 date
    val century = year div 100
    val daysDiff = century - century div 4 - 2
  in
    if (month > 2 orelse (month = 2 andalso #1 date = 29 
                                    orelse year mod 100 > 0))
    then daysDiff
    else daysDiff - 1
  end

(******************************************************************************)

(****************************************************************************** 
  Задание 10 toJulianDay
 ******************************************************************************)
fun toJulianDay (grigDate : date) : date =
  decDateByNum (grigDate, newStyleCorrection (grigDate), false)

(******************************************************************************)

(****************************************************************************** 
  Задание 11 toGrigorianDay
 ******************************************************************************)
fun toGrigorianDay (julianDate : date) : date =
  incDateByNum (julianDate, newStyleCorrection (julianDate), true)

(******************************************************************************)

(****************************************************************************** 
  Задание 12 younger
 ******************************************************************************)
(*fun younger (date1 : date, date2 : date) : bool =
  let
    fun max (x : int, y : int) : c =
  in
    body
  end*)

(******************************************************************************)

(****************************************************************************** 
  Задание 13 youngest
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 14 getNthFixed
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 15 numToDigits
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 16 listElements
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 17 listSum
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 18 maxSmaller
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 19 dateToCorrectionNums
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 20 firstNewMoon
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 21 winterSolstice
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 22 chineseNewYearDate
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 23 getNthString
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 24 dateToString
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 25 chineseYear
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 26 dateToChineseYear
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 27 dateToAnimal
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 28 animal
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 29 extractAnimal
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 30 extractAnimals
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 31 youngestFromAnimals
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 32 oldStyleStudents
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 33 youngestFromOldStyleAnimals
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 34 listOfStringDates
 ******************************************************************************)


(******************************************************************************)

(****************************************************************************** 
  Задание 35 oldStyleStudentStringDates
 ******************************************************************************)


(******************************************************************************)

